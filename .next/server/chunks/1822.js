"use strict";exports.id=1822,exports.ids=[1822],exports.modules={71822:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var r=s(30784),a=s(9885),n=s(24206),l=s(1264),i=s(56388);function QuickPromptsBar({prompts:e,onPick:t,className:s="",label:a="Suggested prompts",sendOnClick:n=!1}){return e&&0!==e.length?(0,r.jsxs)("div",{className:`w-full ${s}`,children:[r.jsx("div",{className:"mb-1 text-xs font-medium text-gray-400",children:a}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:e.map((e,s)=>r.jsx("button",{type:"button",onClick:()=>t(e,{send:n}),title:e,className:"text-left px-3 py-2 rounded-lg bg-[#202636] border border-gray-700/70 hover:border-gray-600 hover:bg-[#253045] text-gray-100 text-xs leading-snug transition",children:e},`${s}-${e.slice(0,28)}`))})]}):null}var o=s(12091);function AssistantFooter(e){return null}function CreditsChip({used:e,limit:t}){return(0,r.jsxs)("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs text-gray-700",title:"Monthly chat credits",children:["Chat: ",e,"/",t]})}function UpgradeCta({href:e="/dashboard/billing"}){return r.jsx("a",{href:e,className:"inline-flex items-center gap-2 rounded-lg bg-black px-3 py-1.5 text-xs font-medium text-white hover:opacity-90",children:"Upgrade to continue"})}var c=s(97151);let u=(0,a.memo)(function({latestContentInfo:e,initialConversationId:t,onNewConversation:s,layout:u="panel"}){let[d,m]=(0,a.useState)(null),[x,g]=(0,a.useState)(""),[h,p]=(0,a.useState)(!1),[f,y]=(0,a.useState)(!1),[b,j]=(0,a.useState)(null),[v,w]=(0,a.useState)(!1),[N,C]=(0,a.useState)(null),[S,I]=(0,a.useState)([]),[k,_]=(0,a.useState)(!0),[$,T]=(0,a.useState)(!0),M=(0,a.useRef)(null),R=(0,a.useRef)(null),q=(0,a.useRef)(new Map),E=(0,a.useRef)(null),[G,P]=(0,a.useState)(null),A=(0,a.useRef)(0),B=(0,a.useRef)(null),O=(0,a.useRef)(null),[U,D]=(0,a.useState)(!1);async function playTTS(e,t){try{if(G===e){E.current?.pause(),E.current=null,P(null);return}E.current&&(E.current.pause(),E.current=null),P(e);let s=++A.current,r=t.length>500?function(e,t=400){let s=e.split(/(?<=[\.!?])\s+/),r=[],a="";for(let e of s)(a+(a?" ":"")+e).length>t?(a&&r.push(a),a=e):a=a?a+" "+e:e;return a&&r.push(a),r.length?r:[e]}(t):[t],a=0,playNext=async()=>{if(A.current!==s)return;if(a>=r.length){P(t=>t===e?null:t);return}let t=`${e}#${a}`,l=q.current.get(t);l||(l=await (0,n.TD)(r[a],{}),q.current.set(t,l));let i=new Audio(l);E.current=i,i.onended=()=>{A.current===s&&(a+=1,playNext())},i.onerror=()=>{A.current===s&&(a+=1,playNext())},await i.play().catch(()=>{P(t=>t===e?null:t)})};playNext()}catch{P(null)}}(0,a.useEffect)(()=>{if(!U)return;let e=setInterval(()=>{let t=O.current;if(!t){clearInterval(e),D(!1);return}let s=t.pos+1;m(e=>{if(!e||e._id!==t.convId||!e.messages[t.msgIndex])return e;let r=t.tokens.slice(0,s).join(""),a=[...e.messages];return a[t.msgIndex]={...a[t.msgIndex],content:r},{...e,messages:a}}),R.current?.scrollIntoView({behavior:"smooth"}),s>=t.tokens.length?(O.current=null,clearInterval(e),D(!1)):O.current={...t,pos:s}},24);return()=>clearInterval(e)},[U]),(0,a.useEffect)(()=>()=>{E.current&&(E.current.pause(),E.current=null),P(null),A.current+=1},[]);let autoGrow=()=>{let e=M.current;e&&(e.style.height="0px",e.style.height=`${e.scrollHeight}px`)};(0,a.useEffect)(()=>{autoGrow()},[x]);let F=(0,a.useRef)(0),z=d?.messages?.length??0;(0,a.useEffect)(()=>{z>F.current&&R.current?.scrollIntoView({behavior:"smooth"}),F.current=z},[z]),(0,a.useEffect)(()=>{let e=!1;if(t&&B.current!==t){if(d&&d._id===t){B.current=t;return}return y(!0),(0,n.Um)(t).then(s=>{e||(m(s),B.current=t,T((s?.messages?.length??0)===0))}).finally(()=>{e||y(!1)}),()=>{e=!0}}},[t]),(0,a.useEffect)(()=>{let e=!1;return _(!0),(0,n.lG)().then(t=>{e||I(t.prompts||[])}).catch(()=>{e||I(["Give me a catchy caption for my last upload","Suggest 5 niche hashtags for my audience","What are my best times to post this week?"])}).finally(()=>{e||_(!1)}),()=>{e=!0}},[]);let sendMessage=async t=>{t?.preventDefault();let r=x.trim();if(!r||h||v)return;T(!1),p(!0),j(null);let a=d?{...d,messages:[...d.messages,{role:"user",content:r}]}:{_id:"temp",messages:[{role:"user",content:r}]};m(a),g("");try{let t=await (0,n.Kc)({question:r,latestContentInfo:e,conversationId:d?._id,title:d?.title||"AI Coach Chat"});switch(t.status){case 402:{let e=t.data;w(!0),j(e.error||"You’ve reached your plan’s chat limit."),e.quota&&C(e.quota),p(!1),d?._id||m(null);return}case 429:{let e=t.data;j(e.message||e.error||"You’re sending messages too fast. Try again shortly."),p(!1),d?._id||m(null);return}case 200:{let e=t.data,i={...e.conversation},o=-1;for(let t=i.messages.length-1;t>=0;t--)if("assistant"===i.messages[t].role){o=t,i.messages[t]={...i.messages[t],meta:{usedContextIds:e.usedContextIds,requestId:e.requestId,latencyMs:e.latencyMs}};break}if(o>=0){var l;let e=i.messages[o].content||"";i.messages[o]={...i.messages[o],content:""},m(i),l={convId:i._id,msgIndex:o,tokens:e.match(/\S+|\s+/g)??[],pos:0},O.current=l,D(!0)}else m(i);p(!1),e.quota&&C(e.quota);let c=1===a.messages.length;if(c&&i._id){B.current=i._id,s?.(i._id);try{let e=await (0,n.uh)(i._id,r);e&&m(t=>t?{...t,title:e}:t)}catch{}}return}default:{let e=t.data;j(e.error||e.message||"Chat failed. Please try again."),p(!1),d?._id||m(null);return}}}catch(e){console.error("CoachChat sendMessage error:",e),j("Something went wrong sending your message. Please try again."),d?._id||m(null),p(!1)}};function CopyButton({text:e}){let[t,s]=(0,a.useState)(!1);async function onCopy(){try{await navigator.clipboard.writeText(e),s(!0),setTimeout(()=>s(!1),1200)}catch{}}let n=!e?.trim();return(0,r.jsxs)("button",{type:"button",onClick:onCopy,disabled:n,className:`inline-flex items-center gap-1 text-xs font-medium transition
        ${n?"opacity-40 cursor-not-allowed":"text-gray-400 hover:text-gray-200"}`,"aria-label":t?"Copied":"Copy answer",title:t?"Copied":"Copy",children:[t?r.jsx(l.Z,{className:"w-4 h-4"}):r.jsx(i.Z,{className:"w-4 h-4"}),r.jsx("span",{children:t?"Copied":"Copy"})]})}let K=!f&&!d?.messages?.length,Z="page"===u;return(0,r.jsxs)("div",{className:"flex flex-col h-full min-h-0",children:[b&&r.jsx("div",{className:"w-full max-w-2xl mx-auto px-4 mb-2",children:r.jsx("div",{className:"rounded-lg border border-red-600/40 bg-red-600/10 text-red-300 text-sm px-3 py-2",children:b})}),(0,r.jsxs)("div",{className:["flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 md:px-4",K?"flex items-center justify-center py-0":"py-6",Z?"pb-40":"",Z&&K?"min-h-[60vh]":""].join(" "),style:{scrollbarGutter:"stable"},children:[f?(0,r.jsxs)("div",{className:"animate-pulse space-y-3 w-full",children:[r.jsx("div",{className:"h-5 w-2/3 rounded-xl bg-gray-200/40"}),r.jsx("div",{className:"h-5 w-1/2 rounded-xl bg-gray-200/40"}),r.jsx("div",{className:"h-5 w-3/5 rounded-xl bg-gray-200/40"})]}):K?r.jsx("p",{className:"text-gray-500 text-center italic",children:"Start your conversation with the AI coach..."}):(0,r.jsxs)(r.Fragment,{children:[d.messages.map((e,t)=>{let s="user"===e.role;return r.jsx("div",{className:`mb-4 ${s?"flex justify-end":"block"}`,children:s?r.jsx("div",{className:"px-4 py-2 text-sm md:text-base max-w-[85%] rounded-2xl leading-relaxed shadow-md bg-blue-600 text-white",children:e.content}):(0,r.jsxs)("div",{className:"max-w-3xl text-gray-100 leading-relaxed",children:[r.jsx("div",{className:"whitespace-pre-wrap",children:e.content}),(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[!(O.current&&d&&O.current.convId===d._id&&O.current.msgIndex===t)&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(CopyButton,{text:e.content}),(0,r.jsxs)("button",{type:"button",onClick:()=>playTTS(`${d._id}:${t}`,e.content),className:`inline-flex items-center gap-1 text-xs px-2 py-1 rounded border ${G===`${d._id}:${t}`?"border-cyan-500 text-cyan-400":"border-gray-600 text-gray-300 hover:text-white"}`,children:[r.jsx(c.Z,{size:14}),G===`${d._id}:${t}`?"Stop":"Play"]})]}),e.meta&&r.jsx(AssistantFooter,{meta:e.meta})]})]})},e._id||t)}),h&&r.jsx("div",{className:"mb-4",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-1 text-gray-400",children:[r.jsx("span",{className:"h-2 w-2 rounded-full bg-current animate-bounce [animation-delay:-0.2s]"}),r.jsx("span",{className:"h-2 w-2 rounded-full bg-current animate-bounce"}),r.jsx("span",{className:"h-2 w-2 rounded-full bg-current animate-bounce [animation-delay:0.2s]"})]})})]}),r.jsx("div",{ref:R})]}),(0,r.jsxs)("form",{onSubmit:sendMessage,className:["shrink-0 w-full max-w-2xl mx-auto px-4 py-3 border-t border-gray-700/50",Z?"fixed inset-x-0 bottom-0 z-30 bg-transparent":"bg-transparent"].join(" "),style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[$&&r.jsx("div",{className:"w-full max-w-2xl mx-auto px-0 mb-3",children:k?(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[r.jsx(o.O,{className:"h-8 w-40"}),r.jsx(o.O,{className:"h-8 w-48"}),r.jsx(o.O,{className:"h-8 w-56"}),r.jsx(o.O,{className:"h-8 w-36"})]}):S.length>0?r.jsx(QuickPromptsBar,{prompts:S,onPick:e=>{g(e),T(!1)}}):null}),r.jsx("div",{className:"mb-2 flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[N&&r.jsx(CreditsChip,{used:N.used,limit:N.limit}),v&&r.jsx(UpgradeCta,{href:"/dashboard/billing"})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-3 bg-[#1a1f2b] border border-gray-700 rounded-xl px-3 py-2",children:[r.jsx("textarea",{ref:M,className:"flex-1 bg-transparent text-gray-100 placeholder-gray-500 focus:outline-none resize-none text-base leading-[1.5] pt-[0.65rem] pb-[0.65rem] overflow-hidden",placeholder:v?"Upgrade to continue chatting…":"Type your message...",value:x,onChange:e=>g(e.target.value),onInput:autoGrow,onKeyDown:e=>{h||v||"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendMessage())},disabled:h||v,rows:1,style:{minHeight:44}}),r.jsx("button",{className:"h-10 px-4 rounded-md bg-gray-700 hover:bg-gray-600 text-white text-sm font-semibold transition disabled:opacity-60",type:"submit",disabled:!x.trim()||h||v,"aria-disabled":h||v,children:h?(0,r.jsxs)("span",{className:"inline-flex items-center gap-2",children:[r.jsx("span",{className:"h-4 w-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Sending…"]}):"Send"})]})]})]})})},12091:(e,t,s)=>{s.d(t,{O:()=>Skeleton});var r=s(30784);function Skeleton({className:e=""}){return r.jsx("div",{className:["animate-pulse rounded-md bg-gray-200/20 dark:bg-gray-700/40",e].join(" "),"aria-hidden":!0})}s(9885)}};