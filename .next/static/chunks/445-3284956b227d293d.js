"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[445],{1243:function(e,t,n){n.d(t,{Z:function(){return a}});var s=n(5531);let a=(0,s.Z)("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]])},9445:function(e,t,n){n.r(t),n.d(t,{default:function(){return d}});var s=n(7437),a=n(2265),r=n(6354),l=n(5531);let i=(0,l.Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),o=(0,l.Z)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function QuickPromptsBar(e){let{prompts:t,onPick:n,className:a="",label:r="Suggested prompts",sendOnClick:l=!1}=e;return t&&0!==t.length?(0,s.jsxs)("div",{className:"w-full ".concat(a),children:[(0,s.jsx)("div",{className:"mb-1 text-xs font-medium text-gray-400",children:r}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:t.map((e,t)=>(0,s.jsx)("button",{type:"button",onClick:()=>n(e,{send:l}),title:e,className:"text-left px-3 py-2 rounded-lg bg-[#202636] border border-gray-700/70 hover:border-gray-600 hover:bg-[#253045] text-gray-100 text-xs leading-snug transition",children:e},"".concat(t,"-").concat(e.slice(0,28))))})]}):null}var c=n(4278);function AssistantFooter(e){return null}function CreditsChip(e){let{used:t,limit:n}=e;return(0,s.jsxs)("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs text-gray-700",title:"Monthly chat credits",children:["Chat: ",t,"/",n]})}function UpgradeCta(e){let{href:t="/dashboard/billing"}=e;return(0,s.jsx)("a",{href:t,className:"inline-flex items-center gap-2 rounded-lg bg-black px-3 py-1.5 text-xs font-medium text-white hover:opacity-90",children:"Upgrade to continue"})}var u=n(1243),d=(0,a.memo)(function(e){var t,n,l;let{latestContentInfo:d,initialConversationId:m,onNewConversation:x,layout:g="panel"}=e,[h,p]=(0,a.useState)(null),[f,y]=(0,a.useState)(""),[v,b]=(0,a.useState)(!1),[j,w]=(0,a.useState)(!1),[N,k]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1),[I,_]=(0,a.useState)(null),[M,E]=(0,a.useState)([]),[q,R]=(0,a.useState)(!0),[T,A]=(0,a.useState)(!0),G=(0,a.useRef)(null),P=(0,a.useRef)(null),z=(0,a.useRef)(new Map),B=(0,a.useRef)(null),[O,U]=(0,a.useState)(null),Z=(0,a.useRef)(0),D=(0,a.useRef)(null),F=(0,a.useRef)(null),[H,K]=(0,a.useState)(!1);async function playTTS(e,t){try{if(O===e){var n;null===(n=B.current)||void 0===n||n.pause(),B.current=null,U(null);return}B.current&&(B.current.pause(),B.current=null),U(e);let s=++Z.current,a=t.length>500?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=e.split(RegExp("(?<=[\\.!?])\\s+")),s=[],a="";for(let e of n)(a+(a?" ":"")+e).length>t?(a&&s.push(a),a=e):a=a?a+" "+e:e;return a&&s.push(a),s.length?s:[e]}(t):[t],l=0,playNext=async()=>{if(Z.current!==s)return;if(l>=a.length){U(t=>t===e?null:t);return}let t="".concat(e,"#").concat(l),n=z.current.get(t);n||(n=await (0,r.TD)(a[l],{}),z.current.set(t,n));let i=new Audio(n);B.current=i,i.onended=()=>{Z.current===s&&(l+=1,playNext())},i.onerror=()=>{Z.current===s&&(l+=1,playNext())},await i.play().catch(()=>{U(t=>t===e?null:t)})};playNext()}catch(e){U(null)}}(0,a.useEffect)(()=>{if(!H)return;let e=setInterval(()=>{var t;let n=F.current;if(!n){clearInterval(e),K(!1);return}let s=n.pos+1;p(e=>{if(!e||e._id!==n.convId||!e.messages[n.msgIndex])return e;let t=n.tokens.slice(0,s).join(""),a=[...e.messages];return a[n.msgIndex]={...a[n.msgIndex],content:t},{...e,messages:a}}),null===(t=P.current)||void 0===t||t.scrollIntoView({behavior:"smooth"}),s>=n.tokens.length?(F.current=null,clearInterval(e),K(!1)):F.current={...n,pos:s}},24);return()=>clearInterval(e)},[H]),(0,a.useEffect)(()=>()=>{B.current&&(B.current.pause(),B.current=null),U(null),Z.current+=1},[]);let autoGrow=()=>{let e=G.current;e&&(e.style.height="0px",e.style.height="".concat(e.scrollHeight,"px"))};(0,a.useEffect)(()=>{autoGrow()},[f]);let V=(0,a.useRef)(0),Q=null!==(l=null==h?void 0:null===(t=h.messages)||void 0===t?void 0:t.length)&&void 0!==l?l:0;(0,a.useEffect)(()=>{if(Q>V.current){var e;null===(e=P.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}V.current=Q},[Q]),(0,a.useEffect)(()=>{let e=!1;if(m&&D.current!==m){if(h&&h._id===m){D.current=m;return}return w(!0),(0,r.Um)(m).then(t=>{var n,s;e||(p(t),D.current=m,A((null!==(s=null==t?void 0:null===(n=t.messages)||void 0===n?void 0:n.length)&&void 0!==s?s:0)===0))}).finally(()=>{e||w(!1)}),()=>{e=!0}}},[m]),(0,a.useEffect)(()=>{let e=!1;return R(!0),(0,r.lG)().then(t=>{e||E(t.prompts||[])}).catch(()=>{e||E(["Give me a catchy caption for my last upload","Suggest 5 niche hashtags for my audience","What are my best times to post this week?"])}).finally(()=>{e||R(!1)}),()=>{e=!0}},[]);let sendMessage=async e=>{null==e||e.preventDefault();let t=f.trim();if(!t||v||C)return;A(!1),b(!0),k(null);let n=h?{...h,messages:[...h.messages,{role:"user",content:t}]}:{_id:"temp",messages:[{role:"user",content:t}]};p(n),y("");try{let e=await (0,r.Kc)({question:t,latestContentInfo:d,conversationId:null==h?void 0:h._id,title:(null==h?void 0:h.title)||"AI Coach Chat"});switch(e.status){case 402:{let t=e.data;S(!0),k(t.error||"You’ve reached your plan’s chat limit."),t.quota&&_(t.quota),b(!1),(null==h?void 0:h._id)||p(null);return}case 429:{let t=e.data;k(t.message||t.error||"You’re sending messages too fast. Try again shortly."),b(!1),(null==h?void 0:h._id)||p(null);return}case 200:{let l=e.data,i={...l.conversation},o=-1;for(let e=i.messages.length-1;e>=0;e--)if("assistant"===i.messages[e].role){o=e,i.messages[e]={...i.messages[e],meta:{usedContextIds:l.usedContextIds,requestId:l.requestId,latencyMs:l.latencyMs}};break}if(o>=0){var s,a;let e=i.messages[o].content||"";i.messages[o]={...i.messages[o],content:""},p(i),a={convId:i._id,msgIndex:o,tokens:null!==(s=e.match(/\S+|\s+/g))&&void 0!==s?s:[],pos:0},F.current=a,K(!0)}else p(i);b(!1),l.quota&&_(l.quota);let c=1===n.messages.length;if(c&&i._id){D.current=i._id,null==x||x(i._id);try{let e=await (0,r.uh)(i._id,t);e&&p(t=>t?{...t,title:e}:t)}catch(e){}}return}default:{let t=e.data;k(t.error||t.message||"Chat failed. Please try again."),b(!1),(null==h?void 0:h._id)||p(null);return}}}catch(e){console.error("CoachChat sendMessage error:",e),k("Something went wrong sending your message. Please try again."),(null==h?void 0:h._id)||p(null),b(!1)}};function CopyButton(e){let{text:t}=e,[n,r]=(0,a.useState)(!1);async function onCopy(){try{await navigator.clipboard.writeText(t),r(!0),setTimeout(()=>r(!1),1200)}catch(e){}}let l=!(null==t?void 0:t.trim());return(0,s.jsxs)("button",{type:"button",onClick:onCopy,disabled:l,className:"inline-flex items-center gap-1 text-xs font-medium transition\n        ".concat(l?"opacity-40 cursor-not-allowed":"text-gray-400 hover:text-gray-200"),"aria-label":n?"Copied":"Copy answer",title:n?"Copied":"Copy",children:[n?(0,s.jsx)(i,{className:"w-4 h-4"}):(0,s.jsx)(o,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:n?"Copied":"Copy"})]})}let Y=!j&&!(null==h?void 0:null===(n=h.messages)||void 0===n?void 0:n.length),L="page"===g;return(0,s.jsxs)("div",{className:"flex flex-col h-full min-h-0",children:[N&&(0,s.jsx)("div",{className:"w-full max-w-2xl mx-auto px-4 mb-2",children:(0,s.jsx)("div",{className:"rounded-lg border border-red-600/40 bg-red-600/10 text-red-300 text-sm px-3 py-2",children:N})}),(0,s.jsxs)("div",{className:["flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 md:px-4",Y?"flex items-center justify-center py-0":"py-6",L?"pb-40":"",L&&Y?"min-h-[60vh]":""].join(" "),style:{scrollbarGutter:"stable"},children:[j?(0,s.jsxs)("div",{className:"animate-pulse space-y-3 w-full",children:[(0,s.jsx)("div",{className:"h-5 w-2/3 rounded-xl bg-gray-200/40"}),(0,s.jsx)("div",{className:"h-5 w-1/2 rounded-xl bg-gray-200/40"}),(0,s.jsx)("div",{className:"h-5 w-3/5 rounded-xl bg-gray-200/40"})]}):Y?(0,s.jsx)("p",{className:"text-gray-500 text-center italic",children:"Start your conversation with the AI coach..."}):(0,s.jsxs)(s.Fragment,{children:[h.messages.map((e,t)=>{let n="user"===e.role;return(0,s.jsx)("div",{className:"mb-4 ".concat(n?"flex justify-end":"block"),children:n?(0,s.jsx)("div",{className:"px-4 py-2 text-sm md:text-base max-w-[85%] rounded-2xl leading-relaxed shadow-md bg-blue-600 text-white",children:e.content}):(0,s.jsxs)("div",{className:"max-w-3xl text-gray-100 leading-relaxed",children:[(0,s.jsx)("div",{className:"whitespace-pre-wrap",children:e.content}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[!(F.current&&h&&F.current.convId===h._id&&F.current.msgIndex===t)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(CopyButton,{text:e.content}),(0,s.jsxs)("button",{type:"button",onClick:()=>playTTS("".concat(h._id,":").concat(t),e.content),className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded border ".concat(O==="".concat(h._id,":").concat(t)?"border-cyan-500 text-cyan-400":"border-gray-600 text-gray-300 hover:text-white"),children:[(0,s.jsx)(u.Z,{size:14}),O==="".concat(h._id,":").concat(t)?"Stop":"Play"]})]}),e.meta&&(0,s.jsx)(AssistantFooter,{meta:e.meta})]})]})},e._id||t)}),v&&(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"inline-flex items-center gap-1 text-gray-400",children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-current animate-bounce [animation-delay:-0.2s]"}),(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-current animate-bounce"}),(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-current animate-bounce [animation-delay:0.2s]"})]})})]}),(0,s.jsx)("div",{ref:P})]}),(0,s.jsxs)("form",{onSubmit:sendMessage,className:["shrink-0 w-full max-w-2xl mx-auto px-4 py-3 border-t border-gray-700/50",L?"fixed inset-x-0 bottom-0 z-30 bg-transparent":"bg-transparent"].join(" "),style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[T&&(0,s.jsx)("div",{className:"w-full max-w-2xl mx-auto px-0 mb-3",children:q?(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)(c.O,{className:"h-8 w-40"}),(0,s.jsx)(c.O,{className:"h-8 w-48"}),(0,s.jsx)(c.O,{className:"h-8 w-56"}),(0,s.jsx)(c.O,{className:"h-8 w-36"})]}):M.length>0?(0,s.jsx)(QuickPromptsBar,{prompts:M,onPick:e=>{y(e),A(!1)}}):null}),(0,s.jsx)("div",{className:"mb-2 flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[I&&(0,s.jsx)(CreditsChip,{used:I.used,limit:I.limit}),C&&(0,s.jsx)(UpgradeCta,{href:"/dashboard/billing"})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-3 bg-[#1a1f2b] border border-gray-700 rounded-xl px-3 py-2",children:[(0,s.jsx)("textarea",{ref:G,className:"flex-1 bg-transparent text-gray-100 placeholder-gray-500 focus:outline-none resize-none text-base leading-[1.5] pt-[0.65rem] pb-[0.65rem] overflow-hidden",placeholder:C?"Upgrade to continue chatting…":"Type your message...",value:f,onChange:e=>y(e.target.value),onInput:autoGrow,onKeyDown:e=>{v||C||"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendMessage())},disabled:v||C,rows:1,style:{minHeight:44}}),(0,s.jsx)("button",{className:"h-10 px-4 rounded-md bg-gray-700 hover:bg-gray-600 text-white text-sm font-semibold transition disabled:opacity-60",type:"submit",disabled:!f.trim()||v||C,"aria-disabled":v||C,children:v?(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-4 w-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Sending…"]}):"Send"})]})]})]})})},4278:function(e,t,n){n.d(t,{O:function(){return Skeleton}});var s=n(7437);function Skeleton(e){let{className:t=""}=e;return(0,s.jsx)("div",{className:["animate-pulse rounded-md bg-gray-200/20 dark:bg-gray-700/40",t].join(" "),"aria-hidden":!0})}n(2265)}}]);