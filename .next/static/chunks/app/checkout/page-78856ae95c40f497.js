(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{8120:function(e,t,n){Promise.resolve().then(n.bind(n,8816))},8816:function(e,t,n){"use strict";n.r(t);var l=n(7437),r=n(2265),a=n(4033),s=n(6354),c=n(388),i=n(9219);t.default=()=>{let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),n=t.get("packageId"),u=i.B.find(e=>e.id===n),[o,d]=(0,r.useState)(!1),[h,f]=(0,r.useState)(!1),{user:x,loading:m}=(0,c.a)({required:!0});(0,r.useEffect)(()=>{},[]);let handlePurchase=async()=>{if(n){d(!0);try{let t=await (0,s.Do)(n);t.message&&(f(!0),e.push("/dashboard"))}catch(e){console.error("Manual purchase failed:",e)}finally{d(!1)}}},handleStripePayment=async()=>{if(n){d(!0);try{await (0,s.Vv)(n)}catch(e){console.error("Stripe checkout error:",e),d(!1)}}};return n?m?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 text-white",children:(0,l.jsx)("h1",{className:"text-xl text-gray-300 font-bold",children:"Loading user info..."})}):(0,l.jsxs)("div",{className:"min-h-screen flex flex-col justify-center items-center bg-gray-900 text-white",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold mb-6",children:"Complete Your Purchase"}),u?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("h1",{className:"text-4xl font-bold mb-4",children:["Checkout: ",u.title]}),(0,l.jsx)("p",{className:"text-xl text-gray-400 mb-4",children:u.features.join(" • ")}),(0,l.jsx)("p",{className:"text-2xl text-green-400 font-bold mb-6",children:u.price})]}):(0,l.jsx)("p",{className:"text-red-400",children:"Invalid package"}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)("button",{onClick:handlePurchase,className:"bg-pink-600 hover:bg-pink-700 px-6 py-3 rounded-lg text-white font-bold",disabled:o,children:o?"Processing...":"Confirm Purchase"}),(0,l.jsx)("button",{onClick:handleStripePayment,className:"bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg text-white font-bold",disabled:o,children:o?"Redirecting...":"Pay with Stripe"})]}),h&&(0,l.jsx)("p",{className:"mt-6 text-green-400",children:"✅ Purchase successful! You can now upload your content."})]}):(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 text-white",children:(0,l.jsx)("h1",{className:"text-3xl text-red-500 font-bold",children:"No package selected."})})}},388:function(e,t,n){"use strict";let l;n.d(t,{U:function(){return clearUserCache},a:function(){return useUser}});var r=n(2265),a=n(2205),s=n(4033);let c=null,i=0;async function fetchUserOnce(){return c||(c=(async()=>{try{let e=await (0,a.r)("".concat(a._,"/api/auth/me"),{method:"GET",cache:"no-store"});l=e.ok?e.data:null}catch(e){l=null}finally{i=Date.now();let e=null!=l?l:null;return c=null,e}})())}function useUser(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{redirectTo:t="/login",required:n=!0,initialUser:a}=e,[c,u]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0),[h,f]=(0,r.useState)(null),x=(0,s.useRouter)();return(0,r.useEffect)(()=>{let e=!1;return(async()=>{try{if(void 0!==a){var r,s;let e=!!(null===(s=window.localStorage)||void 0===s?void 0:null===(r=s.getItem)||void 0===r?void 0:r.call(s,"ai_token"));if(a){l=a,i=Date.now(),u(a),d(!1);return}if(!a&&n&&!e){x.replace(t),u(null),d(!1);return}}let c=Date.now(),o=void 0!==l&&c-i<5e3;if(o&&!n){u(null!=l?l:null),d(!1);return}let h=await fetchUserOnce();if(e)return;u(h),!h&&n&&x.replace(t)}catch(l){if(e)return;f(l),u(null),n&&x.replace(t)}finally{e||d(!1)}})(),()=>{e=!0}},[t,n,x,a]),{user:c,loading:o,error:h,refresh:async()=>{d(!0);try{let e=await fetchUserOnce();u(e)}catch(e){u(null),f(e)}finally{d(!1)}}}}function clearUserCache(){l=void 0,c=null,i=0}},4033:function(e,t,n){e.exports=n(94)}},function(e){e.O(0,[922,426,971,472,744],function(){return e(e.s=8120)}),_N_E=e.O()}]);