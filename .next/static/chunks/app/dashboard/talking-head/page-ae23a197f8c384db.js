(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[954],{2147:function(e,l,a){Promise.resolve().then(a.bind(a,7271))},7271:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return TalkingHeadPage}});var t=a(7437),r=a(2265);let s="web-client",n=[{value:"full",label:"Full"},{value:"crop",label:"Crop"},{value:"resize",label:"Resize"},{value:"none",label:"None"}],o=[{value:"",label:"None"},{value:"gfpgan",label:"GFPGAN"},{value:"RestoreFormer",label:"RestoreFormer"}],i=[{value:"",label:"None"},{value:"realesrgan",label:"Real-ESRGAN"},{value:"gpen",label:"GPEN"}],d=[{value:"512p",label:"512p (High Quality)"},{value:"256p",label:"256p (Faster)"}];function UploadTalkingHead(){let[e,l]=(0,r.useState)(null),[a,c]=(0,r.useState)(null),[u,x]=(0,r.useState)("full"),[m,g]=(0,r.useState)("512p"),[p,b]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[v,y]=(0,r.useState)(1),[j,N]=(0,r.useState)(0),[w,k]=(0,r.useState)(2),[S,_]=(0,r.useState)(!1),[C,I]=(0,r.useState)(""),[E,P]=(0,r.useState)(""),[R,T]=(0,r.useState)(""),[F,G]=(0,r.useState)(null),[H,U]=(0,r.useState)(null),[M,O]=(0,r.useState)(null),[A,D]=(0,r.useState)(void 0),[J,L]=(0,r.useState)(null),[B,z]=(0,r.useState)(null),[V,W]=(0,r.useState)(null),[Y,Z]=(0,r.useState)(!1),[$,Q]=(0,r.useState)([]),[K,X]=(0,r.useState)(!1),[ee,el]=(0,r.useState)("create"),ea=(0,r.useRef)(null),et=(0,r.useCallback)(async()=>{try{X(!0);let e=await fetch("/api/sadtalker/history?userId=".concat(encodeURIComponent(s)),{method:"GET",cache:"no-store"});if(!e.ok)throw Error("History request failed (".concat(e.status,")"));let l=await e.json();Q(Array.isArray(l.items)?l.items:[])}catch(e){console.warn("[sadtalker-ui] history error",e)}finally{X(!1)}},[]),er=(0,r.useMemo)(()=>!!e&&!!a&&!Y,[e,a,Y]);(0,r.useEffect)(()=>{if(!F)return;ea.current&&clearInterval(ea.current);let poll=async()=>{try{var e,l,a,t;let r=await fetch("/api/sadtalker/status?id=".concat(encodeURIComponent(F)),{method:"GET",cache:"no-store"});if(!r.ok)throw Error("Status request failed (".concat(r.status,")"));let s=await r.json();U(null!==(l=s.state)&&void 0!==l?l:null),O(null!==(a=s.remoteState)&&void 0!==a?a:null),"number"==typeof s.progress&&D(s.progress);let n="succeeded"===s.state||"completed"===s.state;n&&(null===(e=s.result)||void 0===e?void 0:e.videoUrl)?(L(s.result.videoUrl),z(new Date().toISOString()),ea.current&&clearInterval(ea.current)):"failed"===s.state&&(W((null===(t=s.error)||void 0===t?void 0:t.message)||"SadTalker job failed"),ea.current&&clearInterval(ea.current))}catch(e){console.warn("[sadtalker-ui] polling error",e)}};return poll(),ea.current=setInterval(poll,3e3),()=>{ea.current&&clearInterval(ea.current)}},[F]),(0,r.useEffect)(()=>{et()},[et]),(0,r.useEffect)(()=>{J&&et()},[J,et]);let renderHistory=()=>(0,t.jsxs)("section",{className:"bg-gray-900/40 border border-gray-800 rounded-2xl p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"History"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-50",children:"Recent talking heads"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Stored per user ID (",s,")."]})]}),(0,t.jsx)("button",{type:"button",onClick:()=>et(),className:"inline-flex items-center justify-center rounded-full border border-gray-700 px-4 py-1.5 text-xs font-semibold text-gray-200 hover:border-blue-400 hover:text-blue-300",children:"Refresh"})]}),K&&(0,t.jsx)("div",{className:"text-sm text-gray-400",children:"Loading your previous renders…"}),!K&&0===$.length&&(0,t.jsx)("div",{className:"text-sm text-gray-400",children:"No talking head videos saved yet. Generate one above to populate this list."}),!K&&$.length>0&&(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:$.map(e=>{let l=e.createdAt?new Date(e.createdAt).toLocaleString():"—",a=e.remoteJobId?"#".concat(e.remoteJobId.slice(-6)):"Job ".concat(e.jobId);return(0,t.jsxs)("article",{className:"rounded-xl border border-gray-800 bg-gray-950/80 p-3 space-y-3",children:[(0,t.jsx)("div",{className:"rounded-lg overflow-hidden bg-black aspect-video",children:(0,t.jsx)("video",{src:e.videoUrl,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,preload:"metadata",controls:!0})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:a}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:l})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 text-sm",children:[(0,t.jsx)("a",{href:e.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"Open"}),(0,t.jsx)("a",{href:e.videoUrl,download:!0,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full bg-blue-600 px-3 py-1 text-xs font-semibold text-white hover:bg-blue-500",children:"Download"})]})]},"".concat(e.jobId,"-").concat(e.remoteJobId||"local"))})})]});async function handleSubmit(l){if(l.preventDefault(),W(null),L(null),z(null),U(null),D(void 0),O(null),!e){W("Please choose a source image (PNG/JPG).");return}if(!a){W("Please choose an audio file (MP3/WAV).");return}Z(!0);try{let l=new FormData;l.append("source_image",e),l.append("driven_audio",a),l.append("preprocess",u),l.append("resolution",m),l.append("expression_scale",v.toString()),l.append("pose_style",j.toString()),l.append("batch_size",w.toString()),l.append("still",S?"true":"false"),p&&l.append("enhancer",p),h&&l.append("background_enhancer",h),C.trim()&&l.append("input_yaw",C.trim()),E.trim()&&l.append("input_pitch",E.trim()),R.trim()&&l.append("input_roll",R.trim()),l.append("userId",s);let t=await fetch("/api/sadtalker/create",{method:"POST",body:l}),r=await t.json();if(!t.ok)throw Error((null==r?void 0:r.error)||"Failed to enqueue SadTalker job");G(r.jobId),U("queued")}catch(e){W((null==e?void 0:e.message)||"Failed to start SadTalker job")}finally{Z(!1)}}return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex gap-2",children:[{label:"Generate",value:"create"},{label:"My videos",value:"history"}].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>el(e.value),className:"rounded-full px-4 py-1.5 text-sm font-semibold transition ".concat(ee===e.value?"bg-blue-600 text-white shadow-lg shadow-blue-600/30":"bg-gray-800/70 text-gray-300 hover:text-white"),children:e.label},e.value))}),"create"===ee&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Source Image (PNG/JPG)"}),(0,t.jsx)("input",{type:"file",accept:"image/png,image/jpeg",onChange:e=>{var a,t;return l(null!==(t=null===(a=e.target.files)||void 0===a?void 0:a[0])&&void 0!==t?t:null)},className:"block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-500"}),(0,t.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Max 10 MB. Use a clear frontal face for best results."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Driven Audio (MP3/WAV)"}),(0,t.jsx)("input",{type:"file",accept:"audio/mpeg,audio/wav",onChange:e=>{var l,a;return c(null!==(a=null===(l=e.target.files)||void 0===l?void 0:l[0])&&void 0!==a?a:null)},className:"block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-500"}),(0,t.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Max 15 MB. Audio will drive lip sync."})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Preprocess"}),(0,t.jsx)("select",{value:u,onChange:e=>x(e.target.value),className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600",children:n.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Resolution"}),(0,t.jsx)("select",{value:m,onChange:e=>g(e.target.value),className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600",children:d.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Face Enhancer"}),(0,t.jsx)("select",{value:p,onChange:e=>b(e.target.value),className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600",children:o.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Background Enhancer"}),(0,t.jsx)("select",{value:h,onChange:e=>f(e.target.value),className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600",children:i.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Expression Scale"}),(0,t.jsx)("input",{type:"range",min:.5,max:1.5,step:.05,value:v,onChange:e=>y(Number(e.target.value)),className:"w-full"}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:v.toFixed(2)})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Pose Style"}),(0,t.jsx)("input",{type:"number",min:-10,max:10,value:j,onChange:e=>N(Number(e.target.value)),className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Batch Size"}),(0,t.jsx)("input",{type:"number",min:1,max:8,value:w,onChange:e=>k(Number(e.target.value)),className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600"})]})]}),(0,t.jsx)("div",{className:"col-span-1 md:col-span-2",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-300",children:[(0,t.jsx)("input",{type:"checkbox",checked:S,onChange:e=>_(e.target.checked),className:"h-4 w-4"}),"Use still-mode (keeps head movements minimal)"]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Input Yaw (comma separated)"}),(0,t.jsx)("input",{type:"text",value:C,onChange:e=>I(e.target.value),placeholder:"e.g. -10,0,10",className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Input Pitch (comma separated)"}),(0,t.jsx)("input",{type:"text",value:E,onChange:e=>P(e.target.value),placeholder:"e.g. -3,0,3",className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Input Roll (comma separated)"}),(0,t.jsx)("input",{type:"text",value:R,onChange:e=>T(e.target.value),placeholder:"e.g. -2,0,2",className:"w-full bg-gray-900 text-gray-100 rounded-md p-3 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600"})]})]}),(0,t.jsx)("button",{type:"submit",disabled:!er,className:"w-full md:w-auto px-6 py-3 rounded-md font-semibold transition ".concat(er?"bg-blue-600 hover:bg-blue-500":"bg-gray-700 cursor-not-allowed"),children:Y?"Submitting…":"Generate Talking Head"})]}),F&&(0,t.jsxs)("div",{className:"bg-gray-800/80 border border-gray-700 rounded-lg p-4 space-y-2",children:[(0,t.jsx)("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Job"}),(0,t.jsx)("div",{className:"text-sm text-gray-300 break-all",children:F}),(0,t.jsxs)("div",{className:"space-y-1 text-sm text-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Status"}),(0,t.jsx)("span",{className:"font-semibold text-blue-400",children:null!=H?H:"queued"})]}),M&&(0,t.jsxs)("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:["Current step: ",(0,t.jsx)("span",{className:"text-gray-300",children:M})]})]}),"number"==typeof A&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"w-full bg-gray-900/70 rounded-full h-2 overflow-hidden",children:(0,t.jsx)("div",{className:"bg-blue-500 h-2 transition-all",style:{width:"".concat(Math.max(5,Math.min(100,A)),"%")}})}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-gray-400",children:[A.toFixed(0),"% complete"]})]})]}),V&&(0,t.jsx)("div",{className:"bg-red-900/40 border border-red-700 text-red-200 rounded-lg p-4 text-sm",children:V}),J&&"create"===ee&&(0,t.jsxs)("section",{className:"bg-gray-900/80 border border-gray-800 rounded-2xl p-6 space-y-5 shadow-2xl shadow-black/40",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Result ready"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-50",children:"Talking head generated successfully"}),B&&(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:["Ready ",new Date(B).toLocaleString(void 0,{hour12:!1})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,t.jsxs)("a",{href:J,download:!0,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-gray-900",children:[(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-5 w-5",children:[(0,t.jsx)("path",{d:"M12 3a1 1 0 0 1 1 1v8.586l2.293-2.293a1 1 0 1 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414L11 12.586V4a1 1 0 0 1 1-1Z"}),(0,t.jsx)("path",{d:"M5 18a1 1 0 0 1 1 1v1h12v-1a1 1 0 1 1 2 0v2a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1Z"})]}),"Download MP4"]}),(0,t.jsx)("a",{href:J,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 rounded-full border border-gray-600 px-5 py-2 text-sm font-semibold text-gray-100 hover:border-blue-400 hover:text-blue-300",children:"View in new tab"})]})]}),(0,t.jsx)("div",{className:"rounded-xl border border-gray-800 overflow-hidden bg-black",children:(0,t.jsx)("video",{controls:!0,src:J,className:"w-full max-h-[480px] object-contain"})})]}),"create"===ee&&renderHistory()]}),"history"===ee&&renderHistory()]})}function TalkingHeadPage(){return(0,t.jsxs)("div",{className:"min-h-screen flex flex-col text-white",children:[(0,t.jsx)("header",{className:"shrink-0 pt-12 md:pt-20 px-6 md:px-12 lg:px-20 max-w-6xl mx-auto w-full",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h1",{className:"text-3xl md:text-4xl font-semibold tracking-tight",children:"Talking Head"})})}),(0,t.jsx)("main",{children:(0,t.jsx)("div",{className:"px-6 md:px-12 lg:px-20 max-w-6xl mx-auto pb-8",children:(0,t.jsxs)("section",{className:"mt-12 mx-auto w-full max-w-3xl bg-gray-800 rounded-lg p-8 shadow-lg",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Generate a Talking Head"}),(0,t.jsx)("p",{className:"text-gray-300 mb-6",children:"Upload a face photo, enter a script, choose a voice, and we’ll render a video."}),(0,t.jsx)(UploadTalkingHead,{})]})})})]})}},622:function(e,l,a){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t=a(2265),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function q(e,l,a){var t,s={},d=null,c=null;for(t in void 0!==a&&(d=""+a),void 0!==l.key&&(d=""+l.key),void 0!==l.ref&&(c=l.ref),l)n.call(l,t)&&!i.hasOwnProperty(t)&&(s[t]=l[t]);if(e&&e.defaultProps)for(t in l=e.defaultProps)void 0===s[t]&&(s[t]=l[t]);return{$$typeof:r,type:e,key:d,ref:c,props:s,_owner:o.current}}l.Fragment=s,l.jsx=q,l.jsxs=q},7437:function(e,l,a){"use strict";e.exports=a(622)}},function(e){e.O(0,[971,472,744],function(){return e(e.s=2147)}),_N_E=e.O()}]);