(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[813,590],{2601:function(t,e,n){"use strict";var r,a;t.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(8960)},3373:function(t,e,n){Promise.resolve().then(n.bind(n,9922))},777:function(t,e,n){"use strict";n.d(e,{Z:function(){return CartProvider},j:function(){return useCart}});var r=n(7437),a=n(2265);let o=(0,a.createContext)(void 0);function CartProvider(t){let{children:e}=t,[n,i]=(0,a.useState)(()=>{try{let t=localStorage.getItem("cartItems");return t?JSON.parse(t):[]}catch(t){}return[]});(0,a.useEffect)(()=>{localStorage.setItem("cartItems",JSON.stringify(n))},[n]);let c=n.reduce((t,e)=>t+e.quantity,0);return(0,r.jsx)(o.Provider,{value:{cartItems:n,setCartItems:i,addToCart:function(t){i(e=>{let n=e.find(e=>e.id===t);return n?e.map(e=>e.id===t?{...e,quantity:e.quantity+1}:e):[...e,{id:t,quantity:1}]})},removeFromCart:function(t){i(e=>e.filter(e=>e.id!==t))},changeQty:function(t,e){i(n=>n.map(n=>n.id===t?{...n,quantity:Math.max(1,e)}:n))},cartCount:c},children:e})}function useCart(){let t=(0,a.useContext)(o);if(!t)throw Error("useCart must be used within a CartProvider");return t}},9360:function(t,e,n){"use strict";n.d(e,{Z:function(){return Reveal}});var r=n(7437),a=n(2265);function Reveal(t){let{as:e,children:n,className:o="",delay:i=0,once:c=!1,threshold:s=.15,...l}=t,u=e||"div",d=(0,a.useRef)(null),[f,h]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let t=d.current;if(!t)return;let e=new IntersectionObserver(t=>{let[n]=t;n.isIntersecting?(h(!0),c&&e.disconnect()):c||h(!1)},{threshold:s});return e.observe(t),()=>e.disconnect()},[c,s]),(0,r.jsx)(u,{ref:d,className:"transition-all duration-1000 ease-out will-change-transform ".concat(f?"opacity-100 translate-y-0":"opacity-0 translate-y-6"," ").concat(o),style:{transitionDelay:"".concat(i,"ms")},...l,children:n})}},44:function(t,e,n){"use strict";n.r(e);var r=n(7437);n(2265),e.default=()=>(0,r.jsx)("div",{className:"flex items-center justify-center w-full h-32",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute -inset-2 rounded-full bg-gradient-to-tr from-cyan-500/20 to-fuchsia-500/20 blur-md animate-pulse"}),(0,r.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-cyan-400/30 border-t-cyan-400 animate-spin"})]})})},4278:function(t,e,n){"use strict";n.d(e,{O:function(){return Skeleton}});var r=n(7437);function Skeleton(t){let{className:e=""}=t;return(0,r.jsx)("div",{className:["animate-pulse rounded-md bg-gray-200/20 dark:bg-gray-700/40",e].join(" "),"aria-hidden":!0})}n(2265)},9922:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return AccountAndBillingPage}});var r=n(7437),a=n(2265),o=n(4033),i=n(388),c=n(777),s=n(2205),l=n(4278),u=n(6354),d=n(44),f=n(9360),h=n(2601);function AccountAndBillingPage(){let{user:t,loading:e}=(0,i.a)({required:!1}),{setCartItems:n}=(0,c.j)(),[p,m]=(0,a.useState)(null),[y,g]=(0,a.useState)(!0),v=(0,o.useRouter)();(0,a.useEffect)(()=>{(async()=>{try{let n=await (0,u.Nn)();if(null==n?void 0:n.hasAccess){var t,e;m({name:null!==(t=n.package)&&void 0!==t?t:"Unknown",uploadsRemaining:null!==(e=n.uploadsRemaining)&&void 0!==e?e:0,expiresAt:n.expiresAt})}else m(null)}catch(t){console.error("Error loading user package:",t),m(null)}finally{g(!1)}})()},[]);let handleLogout=async()=>{try{let t="true"===h.env.NEXT_PUBLIC_USE_BFF,e=t?"/api/auth/logout":"".concat(s._,"/api/auth/logout");await fetch(e,{method:"POST",credentials:"include"})}catch(t){}try{(0,i.U)()}catch(t){}try{(0,u.sm)()}catch(t){}try{n([])}catch(t){}try{localStorage.removeItem("ai_token")}catch(t){}try{sessionStorage.removeItem("justLoggedIn")}catch(t){}v.replace("/")};return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col text-white",children:[(0,r.jsx)("header",{className:"shrink-0 pt-12 md:pt-20 px-6 md:px-12 lg:px-20 max-w-6xl mx-auto w-full",children:(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("h1",{className:"text-3xl md:text-4xl font-semibold tracking-tight",children:"Account & Billing"})})}),(0,r.jsx)("main",{className:"px-6 md:px-12 lg:px-20",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto pb-8",children:y?(0,r.jsx)("div",{className:"py-10 grid place-items-center",children:(0,r.jsx)(d.default,{})}):(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)(f.Z,{as:"section",className:"bg-gray-900 border border-gray-700 rounded-2xl p-6 md:p-8 shadow-md space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Account"}),e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.O,{className:"h-5 w-56"}),(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsx)(l.O,{className:"h-9 w-28"})})]}):(null==t?void 0:t.email)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",t.email]}),(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsx)("button",{className:"px-4 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-700 text-white font-medium transition",onClick:handleLogout,children:"Log Out"})})]}):(0,r.jsx)("p",{className:"text-gray-400",children:"Not signed in."})]}),(0,r.jsxs)(f.Z,{as:"section",className:"bg-gray-900 border border-gray-700 rounded-2xl p-6 md:p-8 shadow-md space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Plan"}),p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Current Plan:"})," ",p.name]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Uploads Remaining:"})," ",p.uploadsRemaining]}),p.expiresAt&&(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Expires:"})," ",new Date(p.expiresAt).toLocaleDateString()]})]}),(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsx)("button",{onClick:()=>v.push("/#packages"),className:"inline-flex items-center justify-center rounded-lg px-4 py-2 bg-cyan-600 hover:bg-cyan-700 transition text-white font-medium",children:"Upgrade Plan"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-red-400",children:"No active plan found."}),(0,r.jsx)("button",{onClick:()=>v.push("/#packages"),className:"inline-flex items-center justify-center rounded-lg px-4 py-2 bg-cyan-600 hover:bg-cyan-700 transition text-white font-medium",children:"View Plans"})]})]})]})})})]})}},388:function(t,e,n){"use strict";let r;n.d(e,{U:function(){return clearUserCache},a:function(){return useUser}});var a=n(2265),o=n(2205),i=n(4033);let c=null,s=0;async function fetchUserOnce(){return c||(c=(async()=>{try{let t=await (0,o.r)("".concat(o._,"/api/auth/me"),{method:"GET",cache:"no-store"});r=t.ok?t.data:null}catch(t){r=null}finally{s=Date.now();let t=null!=r?r:null;return c=null,t}})())}function useUser(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{redirectTo:e="/login",required:n=!0,initialUser:o}=t,[c,l]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),[f,h]=(0,a.useState)(null),p=(0,i.useRouter)();return(0,a.useEffect)(()=>{let t=!1;return(async()=>{try{if(void 0!==o){var a,i;let t=!!(null===(i=window.localStorage)||void 0===i?void 0:null===(a=i.getItem)||void 0===a?void 0:a.call(i,"ai_token"));if(o){r=o,s=Date.now(),l(o),d(!1);return}if(!o&&n&&!t){p.replace(e),l(null),d(!1);return}}let c=Date.now(),u=void 0!==r&&c-s<5e3;if(u&&!n){l(null!=r?r:null),d(!1);return}let f=await fetchUserOnce();if(t)return;l(f),!f&&n&&p.replace(e)}catch(r){if(t)return;h(r),l(null),n&&p.replace(e)}finally{t||d(!1)}})(),()=>{t=!0}},[e,n,p,o]),{user:c,loading:u,error:f,refresh:async()=>{d(!0);try{let t=await fetchUserOnce();l(t)}catch(t){l(null),h(t)}finally{d(!1)}}}}function clearUserCache(){r=void 0,c=null,s=0}},6354:function(t,e,n){"use strict";n.d(e,{BT:function(){return createEmptyConversation},Do:function(){return purchasePackage},Ii:function(){return deleteAnalysisResult},Kc:function(){return coachChat},Nn:function(){return checkUserPackage},TD:function(){return ttsSynthesize},Um:function(){return fetchConversation},Vv:function(){return startCheckout},fA:function(){return sendFeedback},ku:function(){return fetchConversations},lG:function(){return fetchCoachChatPrompts},mF:function(){return analyzeImageMultipart},mI:function(){return fetchAnalysisHistory},sm:function(){return clearApiCaches},uh:function(){return generateConversationTitle}});var r=n(2205),a=n(2601);async function readJsonOrText(t){let e=await t.text();try{return{ok:t.ok,status:t.status,data:JSON.parse(e)}}catch(n){return{ok:t.ok,status:t.status,data:e}}}function ensureOk(t,e){if(!t.ok){let n="string"==typeof t.data?t.data:JSON.stringify(t.data,null,2);throw Error("".concat(e," failed (").concat(t.status,") - ").concat(n))}return t.data}async function fetchAnalysisHistory(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="".concat(r._,"/api/analyze?page=").concat(t,"&limit=").concat(e,"&ts=").concat(Date.now()),a=await (0,r.r)(n,{method:"GET",cache:"no-store"});if(!a.ok)throw Error("Fetch analysis history failed");return a.data}async function deleteAnalysisResult(t){let e=await fetch("".concat(r._,"/api/analyze/").concat(t),{method:"DELETE",headers:{"Content-Type":"application/json"}}),n=await readJsonOrText(e);return ensureOk(n,"Delete analysis result")}async function startCheckout(t){let e="true"===a.env.NEXT_PUBLIC_USE_BFF,n=e?"/api/checkout/create-checkout-session":"".concat(r._,"/api/checkout/create-checkout-session"),o=await fetch(n,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({packageId:t})}),{ok:i,data:c}=await readJsonOrText(o);if(!i)throw Error("string"==typeof c?c:(null==c?void 0:c.error)||"Failed to start checkout");if(!(null==c?void 0:c.url))throw Error("No checkout URL returned");window.location.href=c.url}async function purchasePackage(t){let e="true"===a.env.NEXT_PUBLIC_USE_BFF,n=e?"/api/user/purchase":"".concat(r._,"/api/user/purchase"),o=await fetch(n,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({packageId:t})}),i=await readJsonOrText(o);return ensureOk(i,"Purchase package")}async function checkUserPackage(){let t=Date.now();return void 0!==o.value&&t-o.ts<5e3?o.value:(o.inFlight||(o.inFlight=(async()=>{try{let t=await (0,r.r)("".concat(r._,"/api/user/check-package"),{method:"GET",cache:"no-store"});if(!t.ok)throw Error("Check user package failed");let e=t.data;return o.value=e,o.ts=Date.now(),e}catch(t){if("object"==typeof t&&null!==t&&("number"==typeof t.status&&401===t.status||"string"==typeof t.message&&"Unauthorized"===t.message))return{hasAccess:!1};throw t}finally{o.inFlight=null}})()),o.inFlight)}let o={value:void 0,ts:0,inFlight:null};function clearApiCaches(){o.value=void 0,o.ts=0,o.inFlight=null}async function coachChat(t){let{question:e,latestContentInfo:n,conversationId:a,title:o}=t;try{let t=await fetch("".concat(r._,"/api/coach-chat"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({question:e,latestContentInfo:n,conversationId:a,title:o})}),i=await readJsonOrText(t);if(200===t.status)return{status:200,data:i.data};if(402===t.status)return{status:402,data:i.data};if(429===t.status)return{status:429,data:i.data};return{status:t.status,data:i.data}}catch(t){return{status:0,data:{error:"Network error"}}}}async function fetchConversation(t){let e=await fetch("".concat(r._,"/api/conversations/").concat(t),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include",cache:"no-store"}),n=await readJsonOrText(e);return ensureOk(n,"Fetch conversation")}async function createEmptyConversation(){try{var t,e;let n=await fetch("".concat(r._,"/api/conversations"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),a=await readJsonOrText(n),o=ensureOk(a,"Create conversation");return null!==(e=null!==(t=o._id)&&void 0!==t?t:o.id)&&void 0!==e?e:null}catch(t){return console.error("Error creating new conversation:",t),null}}async function generateConversationTitle(t,e){let n=await fetch("".concat(r._,"/api/conversations/").concat(t,"/generate-title"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({firstUserMessage:e}),cache:"no-store"}),a=await readJsonOrText(n),o=ensureOk(a,"Generate title");return o.title||null}async function fetchConversations(){let t="".concat(r._,"/api/conversations?ts=").concat(Date.now()),e=await (0,r.r)(t,{method:"GET",cache:"no-store"});if(!e.ok)throw Error("Fetch conversations failed");return e.data}async function sendFeedback(t){let e=await fetch("".concat(r._,"/api/feedback"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})}),n=await readJsonOrText(e);if(!n.ok){var a;throw Error("string"==typeof n.data?n.data:(null===(a=n.data)||void 0===a?void 0:a.error)||"Failed to send feedback (".concat(n.status,")"))}return n.data}function analyzeImageMultipart(t){let{file:e,goal:n,linkBase:a,onProgress:o,captions:i=!0,signal:c}=t,s=new FormData;s.append("image",e),n&&s.append("goal",n),a&&s.append("linkBase",a);try{let t=Intl.DateTimeFormat().resolvedOptions().timeZone;t&&s.append("timezone",t)}catch(t){}let l="".concat(r._,"/api/analyze")+(!1===i?"?captions=false":"");return new Promise((t,e)=>{let n=new XMLHttpRequest;n.open("POST",l,!0),n.withCredentials=!0,n.onreadystatechange=()=>{if(4===n.readyState){if(n.status>=200&&n.status<300)try{let e=JSON.parse(n.responseText);t(e)}catch(t){e(Error("Invalid JSON from server."))}else try{let t=JSON.parse(n.responseText);e(Error((null==t?void 0:t.error)||"Upload failed (".concat(n.status,")")))}catch(t){e(Error("Upload failed (".concat(n.status,")")))}}},n.upload&&"function"==typeof o&&(n.upload.onprogress=t=>{t.lengthComputable&&o(Math.round(t.loaded/t.total*100))}),n.onerror=()=>e(Error("Network error"));let r=!1,onAbort=()=>{r=!0;try{n.abort()}catch(t){}e(new DOMException("Aborted","AbortError"))};if(c){if(c.aborted)return onAbort();c.addEventListener("abort",onAbort,{once:!0})}n.send(s);let cleanup=()=>{c&&c.removeEventListener("abort",onAbort)};n.onloadend=()=>{r||cleanup()}})}async function fetchCoachChatPrompts(){let t="".concat(r._,"/api/coach-chat/prompts?ts=").concat(Date.now()),e=await (0,r.r)(t,{method:"GET",cache:"no-store"});if(!e.ok)throw Error("Fetch coach prompts failed");return e.data}async function ttsSynthesize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new URLSearchParams({text:t});return e.voiceId&&n.set("voiceId",e.voiceId),e.format&&n.set("format",e.format),n.set("ts",String(Date.now())),"".concat(r._,"/api/tts?").concat(n.toString())}},2205:function(t,e,n){"use strict";n.d(e,{_:function(){return a},r:function(){return fetchJson}});var r=n(2601);let a=r.env.NEXT_PUBLIC_API_URL||"http://localhost:5001";async function fetchJson(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="true"===r.env.NEXT_PUBLIC_USE_BFF,o=t;try{if(n&&"string"==typeof t)for(let e of["/api/auth/","/api/checkout/","/api/user/"]){if(t.startsWith(a+e)){o=t.slice(a.length);break}let n=t.indexOf(e);if(t.startsWith("http")&&-1!==n){o=t.slice(n);break}}}catch(t){}let i="true"===r.env.NEXT_PUBLIC_HEADER_AUTH,c=new Headers(e.headers);c.has("content-type")||c.set("Content-Type","application/json");try{if(i){var s;let t=null===(s=window.localStorage)||void 0===s?void 0:s.getItem("ai_token");t&&!c.has("authorization")&&c.set("Authorization","Bearer ".concat(t))}}catch(t){}let l=await fetch(o,{...e,credentials:"include",headers:c}),u=await l.text(),d=null;try{d=u?JSON.parse(u):null}catch(t){d=u}if(401===l.status){let t=Error("Unauthorized");throw t.status=401,t.data=d,t}return{ok:l.ok,status:l.status,data:d}}},8960:function(t){!function(){var e={229:function(t){var e,n,r,a=t.exports={};function defaultSetTimout(){throw Error("setTimeout has not been defined")}function defaultClearTimeout(){throw Error("clearTimeout has not been defined")}function runTimeout(t){if(e===setTimeout)return setTimeout(t,0);if((e===defaultSetTimout||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){e=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){n=defaultClearTimeout}}();var o=[],i=!1,c=-1;function cleanUpNextTick(){i&&r&&(i=!1,r.length?o=r.concat(o):c=-1,o.length&&drainQueue())}function drainQueue(){if(!i){var t=runTimeout(cleanUpNextTick);i=!0;for(var e=o.length;e;){for(r=o,o=[];++c<e;)r&&r[c].run();c=-1,e=o.length}r=null,i=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];o.push(new Item(t,e)),1!==o.length||i||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function __nccwpck_require__(t){var r=n[t];if(void 0!==r)return r.exports;var a=n[t]={exports:{}},o=!0;try{e[t](a,a.exports,__nccwpck_require__),o=!1}finally{o&&delete n[t]}return a.exports}__nccwpck_require__.ab="//";var r=__nccwpck_require__(229);t.exports=r}()},622:function(t,e,n){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2265),a=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function q(t,e,n){var r,o={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==e.key&&(l=""+e.key),void 0!==e.ref&&(u=e.ref),e)i.call(e,r)&&!s.hasOwnProperty(r)&&(o[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps)void 0===o[r]&&(o[r]=e[r]);return{$$typeof:a,type:t,key:l,ref:u,props:o,_owner:c.current}}e.Fragment=o,e.jsx=q,e.jsxs=q},7437:function(t,e,n){"use strict";t.exports=n(622)},4033:function(t,e,n){t.exports=n(94)}},function(t){t.O(0,[971,472,744],function(){return t(t.s=3373)}),_N_E=t.O()}]);