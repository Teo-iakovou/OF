(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{2601:function(e,t,n){"use strict";var r,o;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(8960)},5251:function(e,t,n){Promise.resolve().then(n.bind(n,779))},779:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return LoginPage}});var r=n(7437),o=n(2265),a=n(2205),i=n(4033),u=n(388),c=n(2601);function LoginPage(){let[e,t]=(0,o.useState)(""),[n,l]=(0,o.useState)(!1),[s,f]=(0,o.useState)(null),d=(0,i.useRouter)(),{user:h,loading:p}=(0,u.a)({required:!1}),[m,y]=(0,o.useState)(!1),g=(0,i.useSearchParams)(),_=(null==g?void 0:g.get("redirect"))||"/dashboard";async function handleSubmit(t){t.preventDefault(),l(!0),f(null);try{let t="true"===c.env.NEXT_PUBLIC_HEADER_AUTH,n="true"===c.env.NEXT_PUBLIC_USE_BFF,r=n?"/api/auth/login":"".concat(a._,"/api/auth/login"),o=await fetch(r,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!o.ok){let e=await o.text();throw Error(e||"Login failed")}try{let e=await o.clone().json();if(null==e?void 0:e.token)try{localStorage.setItem("ai_token",e.token)}catch(e){}}catch(e){}try{let e=await (0,a.r)("".concat(n?"/api/auth/me":a._+"/api/auth/me"),{method:"GET",cache:"no-store"});if(e.ok){try{sessionStorage.setItem("justLoggedIn","1")}catch(e){}d.replace(_);return}}catch(e){}try{if(t&&localStorage.getItem("ai_token")){try{sessionStorage.setItem("justLoggedIn","1")}catch(e){}d.replace(_);return}}catch(e){}window.location.href="".concat(n?"":a._,"/api/auth/login?email=").concat(encodeURIComponent(e),"&redirect=").concat(encodeURIComponent(_))}catch(e){f((null==e?void 0:e.message)||"Login failed")}finally{l(!1)}}return(0,o.useEffect)(()=>{if(!p&&h){y(!0);let e=setTimeout(()=>d.replace(_),1e3);return()=>clearTimeout(e)}},[h,p,d,_]),(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 text-white px-4",children:(0,r.jsxs)("form",{onSubmit:handleSubmit,className:"w-full max-w-sm bg-gray-800 border border-gray-700 rounded-2xl p-6 shadow",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Sign in"}),m&&(0,r.jsxs)("div",{className:"mb-3 text-sm text-cyan-300 bg-cyan-900/30 border border-cyan-700 rounded p-2",children:["You are already signed in. Redirecting ","/"===_?"home":"to your dashboard","…"]}),(0,r.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Email"}),(0,r.jsx)("input",{type:"email",value:e,onChange:e=>t(e.target.value),className:"w-full px-3 py-2 rounded bg-gray-900 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-cyan-600 mb-3",placeholder:"you@example.com",required:!0}),s&&(0,r.jsx)("div",{className:"text-red-400 text-sm mb-3",children:s}),(0,r.jsx)("button",{type:"submit",disabled:n||!e||m,className:"w-full py-2 rounded bg-cyan-600 hover:bg-cyan-700 disabled:opacity-60",children:n?"Signing in…":"Sign in"})]})})}},388:function(e,t,n){"use strict";let r;n.d(t,{U:function(){return clearUserCache},a:function(){return useUser}});var o=n(2265),a=n(2205),i=n(4033);let u=null,c=0;async function fetchUserOnce(){return u||(u=(async()=>{try{let e=await (0,a.r)("".concat(a._,"/api/auth/me"),{method:"GET",cache:"no-store"});r=e.ok?e.data:null}catch(e){r=null}finally{c=Date.now();let e=null!=r?r:null;return u=null,e}})())}function useUser(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{redirectTo:t="/login",required:n=!0,initialUser:a}=e,[u,l]=(0,o.useState)(null),[s,f]=(0,o.useState)(!0),[d,h]=(0,o.useState)(null),p=(0,i.useRouter)();return(0,o.useEffect)(()=>{let e=!1;return(async()=>{try{if(void 0!==a){var o,i;let e=!!(null===(i=window.localStorage)||void 0===i?void 0:null===(o=i.getItem)||void 0===o?void 0:o.call(i,"ai_token"));if(a){r=a,c=Date.now(),l(a),f(!1);return}if(!a&&n&&!e){p.replace(t),l(null),f(!1);return}}let u=Date.now(),s=void 0!==r&&u-c<5e3;if(s&&!n){l(null!=r?r:null),f(!1);return}let d=await fetchUserOnce();if(e)return;l(d),!d&&n&&p.replace(t)}catch(r){if(e)return;h(r),l(null),n&&p.replace(t)}finally{e||f(!1)}})(),()=>{e=!0}},[t,n,p,a]),{user:u,loading:s,error:d,refresh:async()=>{f(!0);try{let e=await fetchUserOnce();l(e)}catch(e){l(null),h(e)}finally{f(!1)}}}}function clearUserCache(){r=void 0,u=null,c=0}},2205:function(e,t,n){"use strict";n.d(t,{_:function(){return o},r:function(){return fetchJson}});var r=n(2601);let o=r.env.NEXT_PUBLIC_API_URL||"http://localhost:5001";async function fetchJson(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="true"===r.env.NEXT_PUBLIC_USE_BFF,a=e;try{if(n&&"string"==typeof e)for(let t of["/api/auth/","/api/checkout/","/api/user/"]){if(e.startsWith(o+t)){a=e.slice(o.length);break}let n=e.indexOf(t);if(e.startsWith("http")&&-1!==n){a=e.slice(n);break}}}catch(e){}let i="true"===r.env.NEXT_PUBLIC_HEADER_AUTH,u=new Headers(t.headers);u.has("content-type")||u.set("Content-Type","application/json");try{if(i){var c;let e=null===(c=window.localStorage)||void 0===c?void 0:c.getItem("ai_token");e&&!u.has("authorization")&&u.set("Authorization","Bearer ".concat(e))}}catch(e){}let l=await fetch(a,{...t,credentials:"include",headers:u}),s=await l.text(),f=null;try{f=s?JSON.parse(s):null}catch(e){f=s}if(401===l.status){let e=Error("Unauthorized");throw e.status=401,e.data=f,e}return{ok:l.ok,status:l.status,data:f}}},8960:function(e){!function(){var t={229:function(e){var t,n,r,o=e.exports={};function defaultSetTimout(){throw Error("setTimeout has not been defined")}function defaultClearTimeout(){throw Error("clearTimeout has not been defined")}function runTimeout(e){if(t===setTimeout)return setTimeout(e,0);if((t===defaultSetTimout||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){t=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();var a=[],i=!1,u=-1;function cleanUpNextTick(){i&&r&&(i=!1,r.length?a=r.concat(a):u=-1,a.length&&drainQueue())}function drainQueue(){if(!i){var e=runTimeout(cleanUpNextTick);i=!0;for(var t=a.length;t;){for(r=a,a=[];++u<t;)r&&r[u].run();u=-1,t=a.length}r=null,i=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new Item(e,t)),1!==a.length||i||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=noop,o.addListener=noop,o.once=noop,o.off=noop,o.removeListener=noop,o.removeAllListeners=noop,o.emit=noop,o.prependListener=noop,o.prependOnceListener=noop,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function __nccwpck_require__(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}},a=!0;try{t[e](o,o.exports,__nccwpck_require__),a=!1}finally{a&&delete n[e]}return o.exports}__nccwpck_require__.ab="//";var r=__nccwpck_require__(229);e.exports=r}()},622:function(e,t,n){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2265),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,u=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,n){var r,a={},l=null,s=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(s=t.ref),t)i.call(t,r)&&!c.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:o,type:e,key:l,ref:s,props:a,_owner:u.current}}t.Fragment=a,t.jsx=q,t.jsxs=q},7437:function(e,t,n){"use strict";e.exports=n(622)},4033:function(e,t,n){e.exports=n(94)}},function(e){e.O(0,[971,472,744],function(){return e(e.s=5251)}),_N_E=e.O()}]);